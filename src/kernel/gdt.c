#include "gdt.h"

#define GDT_ENTRY_NULL                  0x0000000000000000
#define GDT_ENTRY_KERNEL_CODE64         0x00AF98000000FFFF
#define GDT_ENTRY_DEVICE_CODE64         0x00AFB8000000FFFF
#define GDT_ENTRY_SERVICE_CODE64        0x00AFD8000000FFFF
#define GDT_ENTRY_USER_CODE64           0x00AFF8000000FFFF
#define GDT_ENTRY_KERNEL_DATA64         0x00AF92000000FFFF
#define GDT_ENTRY_DEVICE_DATA64         0x00AFB2000000FFFF
#define GDT_ENTRY_SERVICE_DATA64        0x00AFD2000000FFFF
#define GDT_ENTRY_USER_DATA64           0x00AFF2000000FFFF
#define GDT_ENTRY_DEVICE_CODE32         0x00CFB8000000FFFF
#define GDT_ENTRY_SERVICE_CODE32        0x00CFD8000000FFFF
#define GDT_ENTRY_USER_CODE32           0x00CFF8000000FFFF
#define GDT_ENTRY_DEVICE_DATA32         0x00CFB2000000FFFF
#define GDT_ENTRY_SERVICE_DATA32        0x00CFD2000000FFFF
#define GDT_ENTRY_USER_DATA32           0x00CFF2000000FFFF
#define GDT_ENTRY_DEVICE_CODE16         0x008FB8000000FFFF
#define GDT_ENTRY_SERVICE_CODE16        0x008FD8000000FFFF
#define GDT_ENTRY_USER_CODE16           0x008FF8000000FFFF
#define GDT_ENTRY_DEVICE_DATA16         0x008FB2000000FFFF
#define GDT_ENTRY_SERVICE_DATA16        0x008FD2000000FFFF
#define GDT_ENTRY_USER_DATA16           0x008FF2000000FFFF

#ifndef GDT_NUM_OF_ENTRIES
#define GDT_NUM_OF_ENTRIES              32
#endif

gdt_t gdttable[GDT_NUM_OF_ENTRIES];
uint16_t gdtnumentries = 0;
uint16_t gdtsize = 0;

int gdtinit()
{
    gdttable[0].entry64 = GDT_ENTRY_NULL;
    gdttable[1].entry64 = GDT_ENTRY_KERNEL_CODE64;
    gdttable[2].entry64 = GDT_ENTRY_KERNEL_DATA64;

    gdtnumentries = 3;
    gdtsize = gdtnumentries * sizeof(gdt_t);
    
    return 0;
}